<html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1" /><title>编译时动态配置 Android resValue / BuildConfig / Manifest</title><meta name="twitter:card" content="summary" /><meta name="twitter:site" content="@drak11t" /><meta name="twitter:title" content="编译时动态配置 Android resValue / BuildConfig / Manifest" /><meta name="twitter:description" content="本文参考并得益于我的朋友 @linroid 的文章：xip.io + gradle 在调试时动态设置服务端地址，他写得很好，于是我将在这里写得更普适、完整一点，感谢与分享！"><meta name="description" content="本文参考并得益于我的朋友 @linroid 的文章：xip.io + gradle 在调试时动态设置服务端地址，他写得很好，于是我将在这里写得更普适、完整一点，感谢与分享！"><link rel="icon" href="/assets/favicon.png"><link rel="apple-touch-icon" href="/assets/gravatar.png"><link rel="stylesheet" href="//code.cdn.mozilla.net/fonts/fira.css"><link rel="stylesheet" href="/assets/core.css"><link rel="canonical" href="/gradle-build-config"><link rel="alternate" type="application/atom+xml" title="Black history of Drakeet" href="/feed.xml" /></head><body><aside class="logo"> <a href="/"> <img class="gravatar" width="80px" height="80px" src="/assets/gravatar.png"> </a> <span class="logo-prompt">返回</span></aside><main> <noscript><style> article .footnotes { display: block; }</style></noscript><article><div class="center"><h1>编译时动态配置 Android resValue / BuildConfig / Manifest</h1><time>9 21, 2015</time></div><div class="divider"></div><p><em>本文参考并得益于我的朋友 <span class="site-title"><a href="http://linroid.com/" target="_blank">@linroid</a> 的文章：<a href="http://linroid.com/2015/07/24/dynamic-endpoint-when-debug-by-xip-io-and-gradle/" target="_blank">xip.io + gradle 在调试时动态设置服务端地址</a>，他写得很好，于是我将在这里写得更普适、完整一点，感谢与分享！</span></em></p><p>当我在修改 <code class="highlighter-rouge">telegram</code> 源码的时候，我需要提供 2 个版本，一，我自己的版本，二，分享给大家顺便使用的版本。其实二者唯一的差别就是 App 名称不一样，我自己的版本我想叫 <code class="highlighter-rouge">Tel4Drakeet</code>，但分享给别人，叫这个名字可能不太合适。</p><p>因此，我如果每次手动修改再进行编译，显然很麻烦。于是想到借助 <code class="highlighter-rouge">gradle</code>，想到林的那篇文章，原本我只知道 <code class="highlighter-rouge">buildConfigField</code> 和类似友盟多渠道打包那样，修改清单文件内容 <code class="highlighter-rouge">manifestPlaceholders</code>，但这两种都不是我现在想要的，我要的是能够修改 <code class="highlighter-rouge">res value</code> 的方式，比如修改 <code class="highlighter-rouge">strings.xml</code> 文件中的 <code class="highlighter-rouge">AppName</code> 的值。</p><p>在林的文章中正好找到这点，貌似在整个互联网上并不容易找到。所以我要总结记录下来：</p><h4><strong>使用 gradle 在编译时动态配置 Android resValue </strong></h4><p>在你的 gradle 内容 buildTypes 或者 productFlavors 下面，如 release 体内写上类似：</p><div class="highlighter-rouge"><pre class="highlight"><code><span class="n">resValue</span> <span class="s2">"string"</span><span class="o">,</span> <span class="s2">"AppName"</span><span class="o">,</span> <span class="s2">"Tel4Drakeet"</span>
</code></pre></div><p>意为把名为 AppName 的 string value 值改为 Tel4Drakeet，完整地和多个 buildType 结合可以参考我的 <a href="https://github.com/drakeet/Tel4Drakeet/blob/master/tele4drakeet/build.gradle" target="_blank">Tel4Drakeet</a> 的 gradle 文件。</p><h4><strong>使用 gradle 在编译时动态设置 Android BuildConfig </strong></h4><p>在同上的地方写上：</p><div class="highlighter-rouge"><pre class="highlight"><code><span class="n">buildConfigField</span> <span class="s2">"String"</span><span class="o">,</span> <span class="s2">"ENDPOINT"</span><span class="o">,</span> <span class="s2">"\"http://example.com\""</span>
</code></pre></div><p>gradle sync 一下后，BuildConfig.ENDPOINT 就会被赋值为 http://example.com 就可以供 Java 代码调用了。</p><h4><strong>使用 gradle 在编译时动态设置 Android Manifest</strong></h4><p>我们在使用友盟多渠道打包的时候，有这么种方式可以在编译的时候动态修改清单文件中的内容，从而实现不同渠道不同标识值。</p><p>你需要在 <code class="highlighter-rouge">AndroidManifest.xml</code> 中，对友盟的渠道进行如下配置：</p><div class="highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;meta-data</span>
    <span class="na">android:name=</span><span class="s">"UMENG_CHANNEL"</span>
    <span class="na">android:value=</span><span class="s">"${UMENG_CHANNEL_VALUE}"</span><span class="nt">/&gt;</span>
</code></pre></div><p>然后在你的 product flavor 中写上：</p><div class="highlighter-rouge"><pre class="highlight"><code><span class="n">manifestPlaceholders</span> <span class="o">=</span> <span class="o">[</span><span class="nl">UMENG_CHANNEL_VALUE:</span> <span class="s2">"GooglePlay"</span><span class="o">]</span>
</code></pre></div><p>完整 gradle 文件可以参考我的这个项目：<a href="https://github.com/drakeet/Meizhi/blob/master/app%2Fbuild.gradle" target="_blank">妹纸&amp;gank.io</a>. 这样清单文件中原本预设的 ${UMENG_CHANNEL_VALUE} 这个值就会被替换为”GooglePlay”。如果要和 Java 配合调用，就是如上所示，结合访问 meta-data 即可，这里不展开了。</p><p>:)</p></article></main></body></html>