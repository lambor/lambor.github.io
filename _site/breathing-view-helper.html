<html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Breathing View Helper</title><meta name="twitter:card" content="summary" /><meta name="twitter:site" content="@drak11t" /><meta name="twitter:title" content="Breathing View Helper" /><meta name="twitter:description" content="前天晚上做了个简单的小工具类，叫做 BreathingViewHelper，传入一个 view 和需要的背景颜色之后，它的背景就会呈呼吸式闪动，可以用来做警示一些必要的内容没有填写或选择。"><meta name="description" content="前天晚上做了个简单的小工具类，叫做 BreathingViewHelper，传入一个 view 和需要的背景颜色之后，它的背景就会呈呼吸式闪动，可以用来做警示一些必要的内容没有填写或选择。"><link rel="icon" href="/assets/favicon.png"><link rel="apple-touch-icon" href="/assets/gravatar.png"><link rel="stylesheet" href="//code.cdn.mozilla.net/fonts/fira.css"><link rel="stylesheet" href="/assets/core.css"><link rel="canonical" href="/breathing-view-helper"><link rel="alternate" type="application/atom+xml" title="Black history of Drakeet" href="/feed.xml" /></head><body><aside class="logo"> <a href="/"> <img class="gravatar" width="80px" height="80px" src="/assets/gravatar.png"> </a> <span class="logo-prompt">返回</span></aside><main> <noscript><style> article .footnotes { display: block; }</style></noscript><article><div class="center"><h1>Breathing View Helper</h1><time>6 14, 2015</time></div><div class="divider"></div><p>前天晚上做了个简单的小工具类，叫做 <code class="highlighter-rouge">BreathingViewHelper</code>，传入一个 <code class="highlighter-rouge">view</code> 和需要的背景颜色之后，它的背景就会呈呼吸式闪动，可以用来做警示一些必要的内容没有填写或选择。</p><p>其实实现方法很简单，就是开个线程隔 38毫秒调用一下 <code class="highlighter-rouge">setBackgroundColor</code> 而已，之所以是 <code class="highlighter-rouge">38mm</code> 是因为只要间隔小于50毫秒的刷新率，人的肉眼就会当成是连续的；这样可以避免过多刷新，也是比较友好。</p><p>关键就是一个类呼吸函数，首先想到正弦函数，但正弦函数用起来感觉有点呼吸急促，因为它的呼和吸是均衡的，之后 Google 了下，找到一个更加逼真的呼吸函数：</p><p><img src="/assets/img/2015-06-14-breathing-1.png" alt="" /></p><p><img src="/assets/img/2015-06-14-breathing-2.png" alt="" /></p><p>代码实现：</p><div class="highlighter-rouge"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">static</span> <span class="kt">double</span> <span class="nf">getBreathingY</span><span class="p">(</span><span class="kt">long</span> <span class="n">time</span><span class="o">,</span> <span class="kt">int</span> <span class="n">n</span><span class="o">,</span> <span class="kt">int</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">float</span> <span class="n">k</span> <span class="o">=</span> <span class="mf">1.0f</span> <span class="o">/</span> <span class="mi">3</span><span class="o">;</span>
    <span class="kt">float</span> <span class="n">pi</span> <span class="o">=</span> <span class="mf">3.1415f</span><span class="o">;</span>
    <span class="kt">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">time</span> <span class="o">/</span> <span class="mf">1000.0f</span><span class="o">;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">t</span> <span class="o">/</span> <span class="mf">1000.0f</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="o">((</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="o">*</span> <span class="n">t</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="o">((</span><span class="n">n</span> <span class="o">-</span> <span class="o">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">k</span><span class="o">))</span> <span class="o">*</span> <span class="n">t</span><span class="o">))</span> <span class="o">{</span>
        <span class="kt">double</span> <span class="n">i</span> <span class="o">=</span> <span class="n">pi</span> <span class="o">/</span> <span class="o">(</span><span class="n">k</span> <span class="o">*</span> <span class="n">t</span><span class="o">)</span> <span class="o">*</span> <span class="o">((</span><span class="n">x</span> <span class="o">-</span> <span class="o">(</span><span class="mf">0.5f</span> <span class="o">*</span> <span class="n">k</span> <span class="o">*</span> <span class="n">t</span><span class="o">))</span> <span class="o">-</span> <span class="o">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="o">*</span> <span class="n">t</span><span class="o">);</span>
        <span class="k">return</span> <span class="mf">0.5f</span> <span class="o">*</span> <span class="n">Math</span><span class="o">.</span><span class="na">sin</span><span class="o">(</span><span class="n">i</span><span class="o">)</span> <span class="o">+</span> <span class="mf">0.5f</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="o">((</span><span class="n">n</span> <span class="o">-</span> <span class="o">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">k</span><span class="o">))</span> <span class="o">*</span> <span class="n">t</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="o">*</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">double</span> <span class="n">j</span> <span class="o">=</span> <span class="n">pi</span> <span class="o">/</span> <span class="o">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">k</span><span class="o">)</span> <span class="o">*</span> <span class="n">t</span><span class="o">)</span> <span class="o">*</span> <span class="o">((</span><span class="n">x</span> <span class="o">-</span> <span class="o">(</span><span class="mf">0.5f</span> <span class="o">*</span> <span class="o">(</span><span class="mi">3</span> <span class="o">-</span> <span class="n">k</span><span class="o">)</span> <span class="o">*</span> <span class="n">t</span><span class="o">))</span> <span class="o">-</span> <span class="o">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="o">*</span> <span class="n">t</span><span class="o">);</span>
        <span class="kt">double</span> <span class="n">one</span> <span class="o">=</span> <span class="mf">0.5f</span> <span class="o">*</span> <span class="n">Math</span><span class="o">.</span><span class="na">sin</span><span class="o">(</span><span class="n">j</span><span class="o">)</span> <span class="o">+</span> <span class="mf">0.5f</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">one</span> <span class="o">*</span> <span class="n">one</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div><p>这里关键是要在一个周期之后传入一个新的 n，我的做法就是判断  <code class="highlighter-rouge">if (diffTime &gt; n * t)</code> 然后使 <code class="highlighter-rouge">n++</code>;</p><p>其余没什么好说的啦，有兴趣可以直接看源码：</p><p><a href="https://github.com/drakeet/BreathingViewHelper" target="_blank">https://github.com/drakeet/BreathingViewHelper</a></p></article></main></body></html>